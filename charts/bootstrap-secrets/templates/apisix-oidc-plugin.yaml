apiVersion: apisix.apache.org/v2
kind: ApisixPluginConfig
metadata:
  name: my-oidc-authcode
spec:
  plugins:
    - name: openid-connect
      enable: true
      config:
        discovery: "{{ .Values.oidc.discoveryUrl }}"
        client_id: "{{ .Values.oidc.clientId }}"
        client_secret: "{{ .Values.oidc.clientSecret }}"
        bearer_only: false
        #redirect_uri: "/anything/callback"
        #redirect_uri: "https://prometheus.danielkaeser2026.de/anything/callback"
        scope: "openid profile email"
        session:
          secret: "{{ .Values.oidc.sessionSecret }}"
        # optional but often useful:
        set_access_token_header: true
        #set_refresh_token_header: true
        access_token_in_authorization_header: true
        set_userinfo_header: true
        use_pkce: true
        # unauth_action: "auth"
